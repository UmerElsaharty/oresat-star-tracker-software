# oresat-star-tracker-software

### Introduction

This is a modified version of [OpenStarTracker](https://openstartracker.org), originally developed by Andrew Tennenbaum at the University at Buffalo. Some of the information below comes from the original README file in the [OpenStarTracker repository](https://github.com/UBNanosatLab/openstartracker).

### Dependencies

These *should* be taken care of by the package manager, but they also are readily available from package repositories. Note that SWIG may have to be installed from source should the packaged version be outdated.

- [Python 3](https://www.python.org/)
    - [NumPy](https://numpy.org/)
    - [SciPy](https://www.scipy.org/)
    - [pydbus](https://github.com/LEW21/pydbus)
    - [Astropy](https://www.astropy.org/)
- [OpenCV](https://opencv.org/) (with Python wrappers)
- [SWIG](http://swig.org/) (version 4.0.1 or greater)
- [astrometry.net](http://astrometry.net/)

Once you have installed astrometry.net, you must also grab the corresponding FITS files and place them in the appropriate directory. For example:

```
cd /usr/share/astrometry
sudo wget http://data.astrometry.net/4100/index-4112.fits
sudo wget http://data.astrometry.net/4100/index-4113.fits
sudo wget http://data.astrometry.net/4100/index-4114.fits
sudo wget http://data.astrometry.net/4100/index-4115.fits
sudo wget http://data.astrometry.net/4100/index-4116.fits
sudo wget http://data.astrometry.net/4100/index-4117.fits
sudo wget http://data.astrometry.net/4100/index-4118.fits
sudo wget http://data.astrometry.net/4100/index-4119.fits
```

Technically, you should only need the FITS files which correspond to your camera's FOV, but it doesn't hurt to just get them all.

### Setting up cameras

Each "camera" is represented by a subdirectory in the `data` directory. To set up a fresh dataset:

```
cd data
mkdir yourcamera
mkdir yourcamera/samples
mkdir yourcamera/calibration_data
```

Then, add 3-10 star images of different parts of the sky taken with your camera to `yourcamera/samples`.

### Installation

This software is intended to be used as a Debian package in conjuction with [Oresat's Linux updater](https://github.com/oresat/oresat-linux-updater). Everything is coordinated via a Makefile in the root directory, which has the following targets.

- `beast` - Compile the back-end for OpenStarTracker. This should be done before building the package.
- `package` - Build a Debian package with current cameras and compiled back-end.
- `clean-beast` - Clean files generated by the `beast` target.
- `clean-package` - Clean files generated by the `package` target.
- `clean` - Run `clean-beast` and `clean-package`.

Once the Debian package has been built, it can be installed with `dpkg`. To start the star tracker, simply run `sudo systemctl start oresat-star-tracker`. At this point, the star tracker will start to randomly solve images from the `downsample` camera and send the results over D-Bus.